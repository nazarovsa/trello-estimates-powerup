<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://p.trellocdn.com/power-up.min.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      padding: 16px;
      margin: 0;
    }
    .total-display {
      text-align: center;
      color: #172b4d;
    }
    .total-number {
      font-size: 32px;
      font-weight: bold;
      color: #0079bf;
      margin: 8px 0;
    }
    .total-label {
      font-size: 14px;
      color: #5e6c84;
    }
  </style>
</head>
<body>
  <div class="total-display">
    <div class="total-label">Total Estimate</div>
    <div id="total" class="total-number">Loading...</div>
  </div>

  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <script>
    /* global TrelloPowerUp */
    var t = TrelloPowerUp.iframe();
    var ESTIMATE_KEY = 'estimate';

    // Calculate total for this list
    t.cards('all')
      .then(function(cards) {
        var total = 0;
        var promises = cards.map(function(card) {
          return t.get(card.id, 'shared', ESTIMATE_KEY)
            .then(function(estimate) {
              if (estimate && !isNaN(parseFloat(estimate))) {
                total += parseFloat(estimate);
              }
            });
        });
        
        return Promise.all(promises).then(function() {
          // Round to 2 decimal places
          total = Math.round(total * 100) / 100;
          document.getElementById('total').textContent = total;
        });
      })
      .catch(function(error) {
        document.getElementById('total').textContent = 'Error';
        console.error(error);
      });
  </script>
</body>
</html>
