<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Card Estimates Power-Up</title>
  <script>
    // Load CSS with fallback
    (function() {
      var TRELLO_CDN_CSS = 'https://p.trellocdn.com/power-up.min.css';
      var LOCAL_CSS = './power-up.min.css';

      function loadCSS(href) {
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = href;

        var loaded = false;
        var timeout;

        link.onload = function() {
          if (!loaded) {
            loaded = true;
            clearTimeout(timeout);
          }
        };

        link.onerror = function() {
          if (!loaded) {
            loaded = true;
            clearTimeout(timeout);
            // Load local fallback
            var fallback = document.createElement('link');
            fallback.rel = 'stylesheet';
            fallback.href = LOCAL_CSS;
            document.head.appendChild(fallback);
          }
        };

        // Timeout fallback (2 seconds)
        timeout = setTimeout(function() {
          if (!loaded) {
            loaded = true;
            console.warn('CSS loading timeout');
            var fallback = document.createElement('link');
            fallback.rel = 'stylesheet';
            fallback.href = LOCAL_CSS;
            document.head.appendChild(fallback);
          }
        }, 2000);

        document.head.appendChild(link);
      }

      loadCSS(TRELLO_CDN_CSS);
    })();
  </script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      padding: 20px;
      margin: 0;
    }
    .estimate-input {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      border: 1px solid #ddd;
      border-radius: 3px;
      box-sizing: border-box;
    }
    .estimate-input:focus {
      outline: none;
      border-color: #0079bf;
    }
    .button-group {
      margin-top: 10px;
      display: flex;
      gap: 8px;
    }
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }
    .btn-primary {
      background-color: #0079bf;
      color: white;
    }
    .btn-primary:hover {
      background-color: #026aa7;
    }
    .btn-secondary {
      background-color: #f4f5f7;
      color: #172b4d;
    }
    .btn-secondary:hover {
      background-color: #ebecf0;
    }
    .total-display {
      text-align: center;
      font-size: 16px;
      color: #172b4d;
    }
    .total-number {
      font-size: 24px;
      font-weight: bold;
      color: #0079bf;
      margin: 10px 0;
    }
    .label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #172b4d;
    }
  </style>
</head>
<body>
  <script>
    // Smart loader with fallback - optimized for faster loading
    (function() {
      var TRELLO_CDN = 'https://p.trellocdn.com/power-up.min.js';
      var LOCAL_FALLBACK = './power-up.min.js';
      var TIMEOUT = 3000; // 3 seconds timeout

      function loadScript(src, onSuccess, onError) {
        var script = document.createElement('script');
        var timeout;
        var loaded = false;
        
        script.onload = function() {
          if (!loaded) {
            loaded = true;
            clearTimeout(timeout);
            if (onSuccess) onSuccess();
          }
        };
        
        script.onerror = function() {
          if (!loaded) {
            loaded = true;
            clearTimeout(timeout);
            if (onError) onError();
          }
        };

        // Timeout fallback
        timeout = setTimeout(function() {
          if (!loaded) {
            loaded = true;
            console.warn('Script loading timeout:', src);
            if (onError) onError();
          }
        }, TIMEOUT);

        script.src = src;
        document.head.appendChild(script);
      }

      function initPowerUp() {
        if (typeof TrelloPowerUp === 'undefined') {
          console.error('TrelloPowerUp not loaded');
          return;
        }
        
        // Load client.js after TrelloPowerUp is ready
        var clientScript = document.createElement('script');
        clientScript.src = './client.js';
        document.body.appendChild(clientScript);
      }

      // Try CDN first
      console.log('Loading Trello Power-Up library...');
      loadScript(
        TRELLO_CDN,
        function() {
          console.log('✓ Loaded from CDN');
          initPowerUp();
        },
        function() {
          console.log('CDN failed, trying local fallback...');
          
          // Try local fallback
          loadScript(
            LOCAL_FALLBACK,
            function() {
              console.log('✓ Loaded from local library');
              initPowerUp();
            },
            function() {
              console.error('✗ Failed to load library from both CDN and local');
            }
          );
        }
      );
    })();
  </script>
</body>
</html>
